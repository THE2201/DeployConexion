<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tablero | Conexion</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
      defer
    ></script>

    <script>
      tailwind.config = {
        darkMode: "media",
      };
    </script>
  </head>
  <body
    class="bg-gray-100 dark:bg-neutral-900 min-h-screen flex items-center justify-center"
  >
    <div
      class="bg-white dark:bg-gray-800 p-8 rounded shadow-lg w-full max-w-md text-center space-y-4"
    >
      <h1 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">
        Tablero Moodcamp 25
      </h1>

      <svg
        class="bg-transparent rounded p-1 mx-auto"
        viewBox="0 0 667 375"
        width="60%"
      >
        <path
          d="m265.08 262.72c0.39163-0.48685 0.78329-0.97369 1.6795-1.6613 0.75037-0.51077 0.99618-0.82074 1.242-1.1307 0 0-0.011322 0.068023 0.30841 0.010528 1.0925-1.3703 1.8652-2.6831 2.638-3.9959 0 0 0.046417 0.045242 0.30173-0.063461 0.44714-0.46123 0.63901-0.81375 0.83087-1.1663 0 0-0.016387-0.23424 0.33923-0.4926 0.79318-0.99919 1.2308-1.74 1.6684-2.4808-0.012329-0.259 0.093597-0.45366 0.85806-0.70482 1.0761-1.1759 1.6119-2.231 2.1476-3.2861-0.007569-0.2728 0.10757-0.47614 1.011-0.6306 4.3256-0.050842 7.9857-0.11951 11.646-0.1039 9.4759 0.040436 9.4731 0.055908 11.605 9.2247 0.07193 0.30951 0.31912 0.57825 0.48462 0.866 0.71237 3.9716 1.5643 7.9241 2.1132 11.918 2.4622 17.916 5.835 35.54 15.67 51.196 0.16223 0.25827 0.1936 0.59876 0.51566 1.6513-5.8078 4.5722-11.507 9.8121-17.916 13.953-14.889 9.6198-31.002 16.774-48.33 20.672-9.195 2.0687-18.606 3.3054-27.978 4.4353-21.183 2.554-41.634-1.5652-61.656-7.9277-17.167-5.4553-32.966-13.925-46.818-25.394-14.178-11.738-27.02-24.868-36.28-41.089-4.7019-8.2367-10.603-15.906-14.371-24.527-4.1786-9.561-7.4837-19.734-9.4534-29.971-2.3734-12.334-3.4557-24.988-4.1465-37.556-0.6952-12.648 2.635-24.917 5.0723-37.285 2.8918-14.673 9.1947-27.978 14.992-41.492 2.1456-5.0017 5.6072-9.5027 8.8518-13.953 3.9664-5.4397 7.8393-11.097 12.635-15.751 9.6697-9.3826 19.266-19.087 30.161-26.885 9.2986-6.6552 20.048-11.657 30.754-15.868 10.698-4.2077 22.064-6.835 33.286-9.5383 5.3708-1.2938 11.085-1.1591 16.644-1.6775 3.596-0.33536 7.1944-0.9882 10.786-0.94822 4.8689 0.054201 9.7702 0.36678 14.589 1.052 7.7147 1.097 15.41 2.4078 23.046 3.9598 11.649 2.3677 22.803 6.2215 32.99 12.469 9.0669 5.5605 18.627 10.552 26.862 17.172 9.5645 7.6885 18.491 16.37 26.667 25.538 11.308 12.681 19.351 27.577 25.658 43.354 1.0934 2.7352 2.2465 5.5591 2.5753 8.4332 0.13574 1.1865-1.7105 3.6124-2.8607 3.7494-3.9421 0.46945-7.9753 0.17438-12.779-0.13243-17.645-0.39377-34.485-0.49194-51.325-0.54332-0.60086-0.001831-1.2032 0.45912-1.8048 0.70438-6.3257 0.053451-12.667 0.36308-18.969 0.008591-1.9616-0.11032-4.6692-1.541-5.5938-3.1802-6.9399-12.305-16.963-21.42-29.216-27.904-15.596-8.2541-32.072-10.59-49.012-4.3111-7.242 2.6842-15.284 4.7801-21.055 9.484-7.9952 6.5173-14.86 14.753-20.989 23.144-7.7489 10.607-11.204 23.21-13.162 36.15-4.1659 27.536 0.88048 52.491 18.297 75.119 9.8194 12.758 21.839 21.573 36.514 26.709 6.7465 2.3613 14.713 3.7729 21.616 2.6032 12.947-2.194 26.196-4.7745 36.888-13.663 2.3676-1.968 5.0473-3.5606 8.0373-5.7499 0.88159-1.1209 1.3091-1.8181 1.7365-2.5152z"
          fill="#FEA303"
        />
        <path
          d="m407.83 253.01c1.1677 11.143 4.1068 21.273 14.399 27.79 13.487 8.5389 30.817 5.4226 41.292-4.0316 2.9725-2.6827 4.5537-6.907 7.3673-10.828 1.4318-3.8949 2.9511-7.3778 2.9934-10.879 0.23489-19.443 0.13727-38.89 0.069336-58.335-0.006775-1.9356-0.58057-3.8693-0.95349-5.9513-0.062348-0.14738-0.11154-0.46362-0.12085-0.79372-0.56155-0.96967-1.1138-1.6092-1.6671-2.2488 0 1.5e-5 -0.12988-0.23517-0.2417-0.64142-0.41736-0.63069-0.72293-0.85515-1.0285-1.0796 0 0 0.060608-0.004669-0.082397-0.3432-2.1702-0.7928-4.1946-1.6254-6.2252-1.6409-14.968-0.11468-29.937-0.053054-44.906-0.073623-11.397-0.015656-11.39-0.032761-10.871-11.248 0.069122-1.494 0.028626-2.9933 0.029083-4.4901 0.005494-17.131 0.14377-34.264-0.075683-51.392-0.059448-4.6385 1.4976-6.0015 6.0467-5.9256 14.632 0.24417 29.271 0.12206 43.907 0.049271 2.1141-0.010506 4.2257-0.52518 6.5551-0.92631 0.4967-0.30526 0.7344-0.53456 0.92984-0.80766 2.8405-0.70888 5.3607-1.8113 6.7623-5.4908 0.76135-1.7766 1.0696-3.082 1.0708-4.3876 0.01889-21.425-9.77e-4 -42.849 0.1171-64.64 0.38409-3.8724 2.8256-3.8974 5.4852-3.8945 15.058 0.016645 30.116-0.039761 45.174-0.071291 8.4453-0.22867 16.891-0.45734 25.887-0.3435 2.4722 0.42453 4.3937 0.50655 6.3151 0.58857 0 0-0.055176 0.025448-0.097351 0.46729-0.042481 22.438-0.064087 44.434-0.002564 66.43 0.004944 1.7716 0.5813 3.5416 0.89209 5.3123 1.4797 1.8703 2.9594 3.7405 5.1132 5.9993 2.484 0.53043 4.2935 0.78991 6.1039 0.79566 14.773 0.046852 29.547 0.052711 44.321 0.058067 10.582 0.00383 10.486-0.003868 10.621 10.778 0.092956 7.4252 0.49823 14.846 0.81427 22.729 0.09729 8.7864 0.14429 17.114-0.052735 25.772-0.43646 2.636-0.72949 4.9371-0.80212 7.245-0.21002 6.6759-0.8482 7.3694-7.551 7.382-16.491 0.031021-32.982-0.006103-49.472 0.077027-2.7 0.01361-5.9212-0.63455-6.9797 3.1862-0.33545 0.72839-0.6709 1.4568-1.2474 2.6471-0.44525 0.69388-0.60907 0.95149-0.7326 1.2348 0 0-0.013611-0.10664-0.2467 0.19743-0.42523 2.2735-0.77661 4.2422-0.784 6.2123-0.054383 14.49 0.07611 28.981-0.087586 43.469-0.11078 9.8048-0.6225 19.605-0.91803 29.408-0.098327 3.262-0.08197 6.5275-0.11804 9.7914-2.4117 13.243-7.3763 25.36-15.604 36.115-9.6541 12.62-20.007 24.042-34.845 31.275-12.109 5.9024-23.954 11.361-37.668 11.489-1.912 0.017883-3.8189 0.59528-6.6305 0.86389-12.712-0.046326-24.522-0.042908-36.333-0.03949-13.588-0.44678-26.443-3.1396-38.925-9.168-10.159-4.9069-19.488-10.742-27.526-18.357-12.177-11.535-20.766-25.521-25.277-41.831-0.25604-0.92572-0.63248-1.8181-0.70804-3.4168 0.15817-1.9868 0.11951-3.2881-0.022674-4.5781-1.0879-9.8698-2.2698-19.73-3.2635-29.609-0.43195-4.2942 1.9542-5.8706 6.0732-5.8583 22.464 0.067032 44.929 0.044067 67.394 0.011474 2.6129-0.003799 4.602 0.40596 4.7384 3.6615 0.032806 0.78268 1.0362 1.5247 1.5932 2.2854z"
          fill="#FEA302"
        />
      </svg>

      <p id="welcomeMessage" class="text-gray-600 dark:text-gray-300 text-end">
        Cargando usuario...
      </p>

      <p id="lastEnrolled" class="text-gray-600 dark:text-gray-300 text-end">
        Última inscripción: cargando...
      </p>
      <p id="totalEnrolled" class="text-gray-600 dark:text-gray-300 text-end">
        Total inscritos: cargando...
      </p>

      <a
        href="enrollments.html"
        class="block bg-orange-600 hover:bg-orange-700 text-white font-semibold py-2 px-4 rounded transition"
      >
        Lista de Inscripciones
      </a>

      <a
        href="payments.html"
        class="block bg-orange-600 hover:bg-orange-700 text-white font-semibold py-2 px-4 rounded transition"
      >
        Control de Pagos
      </a>

      <a
        href="sizes.html"
        class="block bg-orange-600 hover:bg-orange-700 text-white font-semibold py-2 px-4 rounded transition"
      >
        Tallas recibidas
      </a>

      <a
        href="../../api/logout.php"
        class="block bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded transition"
      >
        Cerrar Sesión
      </a>
    </div>
  </body>

  <script>
    async function loadDashboardData() {
      try {
        const res = await fetch("../../api/dashboard_data.php", {
          credentials: "include",
        });

        const text = await res.text();
        let data;

        try {
          data = JSON.parse(text);
        } catch (err) {
          console.error("Invalid JSON:", text);
          throw new Error("Invalid JSON response");
        }

        if (!res.ok) throw new Error(data.error || "No autenticado");

        document.getElementById(
          "welcomeMessage"
        ).textContent = `Iniciaste como ${data.username}`;
        document.getElementById(
          "lastEnrolled"
        ).textContent = `Última inscripción: ${data.last_enrolled}`;
        document.getElementById(
          "totalEnrolled"
        ).textContent = `Total inscritos: ${data.enrollment_count}`;
      } catch (err) {
        console.error("Error loading dashboard:", err);
        document.getElementById("welcomeMessage").textContent =
          "No autenticado. Redirigiendo...";
        setTimeout(() => {
          window.location.href = "../logger.html";
        }, 1500);
      }
    }
    window.addEventListener("DOMContentLoaded", loadDashboardData);
  </script>
</html>
